<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Amherst - Event Map</title>
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Event Map</h1>
    <div id="map"></div>

    <script>
        // Initialize the map centered around Amherst College
        function initMap() {
            const amherstCollege = { lat: 42.3732, lng: -72.5199 };  // Coordinates of Amherst College
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: amherstCollege,
            });

            // Event data with only location names
            const events = {{ event_data|safe }};  // List of event objects with "title" and "location"

            // Initialize the Geocoder
            const geocoder = new google.maps.Geocoder();

            // Loop through events and geocode each location name
            events.forEach(event => {
                geocoder.geocode({ 'address': event.location }, function(results, status) {
                    if (status === 'OK' && results[0]) {
                        // Place a marker at the geocoded location
                        const marker = new google.maps.Marker({
                            map: map,
                            position: results[0].geometry.location,
                            title: event.title,
                        });

                        // Optional: Add an info window to each marker
                        const infoWindow = new google.maps.InfoWindow({
                            content: `<h3>${event.title}</h3><p>${event.location}</p>`
                        });
                        marker.addListener('click', () => infoWindow.open(map, marker));
                    } else {
                        console.error(`Geocode was not successful for the following reason: ${status}`);
                    }
                });
            });
        }
    </script>

    <!-- Replace YOUR_API_KEY with your Google Maps API key -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>
</body>
</html>
